# Техническое задание: Разработка асинхронного HTTP-сервера для Windows

## 1. Общие сведения
Необходимо разработать асинхронный или многопоточный (на выбор) HTTP-сервер на языке C++ специально для платформы Windows. Сервер должен быть способен обрабатывать множественные одновременные подключения с использованием нативного Windows API.

## 2. Технические ограничения и стек
*   **Язык программирования:** C++17.
*   **Платформа:** Windows 10/11, Windows Server 2019+.
*   **Компилятор:** MSVC 2019+.
*   **Допустимые библиотеки:**
    *   STL (Standard Template Library).
    *   Windows API (WinAPI).
    *   `nlohmann::json` (для работы с JSON).

## 3. Функциональные требования

### 3.1. Базовый сетевой функционал
*   **Протокол:** TCP/IP.
*   **Порт:** Сервер должен принимать подключения на указанном порту.
*   **Методы HTTP:** Поддержка GET и POST.
*   **Заголовки:** Корректная обработка заголовков `Content-Length` и `Connection`.

### 3.2. API Endpoints
Сервер должен реализовывать следующую бизнес-логику:

1.  **`GET /info`**
    *   Возвращает JSON с информацией о сервере.
    *   **Состав данных:**
        *   Версия сервера.
        *   Время запуска.
        *   Количество активных подключений.
        *   Системная информация (полученная через WinAPI).

2.  **`POST /data`**
    *   Принимает JSON вида `{"key": "value"}`.
    *   Сохраняет данные в thread-safe (потокобезопасном) хранилище.
    *   Возвращает статус **201 Created**.

3.  **`GET /data/<key>`**
    *   Возвращает значение по ключу в формате JSON.
    *   Если ключ не найден, возвращает статус **404 Not Found**.

## 4. Архитектурные требования и Windows-specific особенности

### 4.1. Производительность и многопоточность
*   Реализация пула рабочих потоков (Thread Pool).
*   Размер пула: **N = Количество CPU * 2**.
*   Минимизация блокировок в рабочих потоках (worker threads).

### 4.2. Использование Windows API
*   Использование **WSARecv / WSASend** вместо стандартных блокирующих сокетных функций (`recv`, `send`).
*   Обработка ошибок через `GetLastError()` с последующим преобразованием в кроссплатформенные коды или понятные сообщения.
*   Получение системной информации для эндпоинта `/info` через функции Windows API:
    *   `GetSystemInfo`
    *   `GetVersionEx` (или аналоги).

### 4.3. Безопасность и HTTPS
*   **HTTPS:** Поддержка защищенных соединений через **Schannel** (нативная реализация SSL/TLS в Windows).
*   **Валидация:**
    *   Проверка входных данных (размер JSON, корректность ключей).
    *   Защита от переполнения буфера при чтении запросов.

### 4.4. Управление ресурсами
*   Полное освобождение всех ресурсов (сокеты, память, дескрипторы) при завершении работы или закрытии соединения.
*   Поддержка **Graceful Shutdown**: корректное завершение работы сервера с обработкой активных подключений перед выходом.

## 5. Контроль качества

*   **Юнит-тестирование:** Написание тестов с использованием **Microsoft Unit Testing Framework**.
*   **Надежность:** Устойчивость к `malformed` (некорректно сформированным) HTTP-запросам.

## 6. Критерии оценки реализации

1.  **Архитектура:**
    *   Правильное управление памятью для асинхронных и/или многопоточных операций.
    *   Корректная реализация Thread-safe структур данных.
2.  **Windows компетенция:**
    *   Корректная работа с Windows Sockets API (Winsock 2).
    *   Глубокое понимание Windows threading model.
3.  **Производительность:**
    *   Отсутствие лишних блокировок.
    *   Оптимальный размер буферов ввода-вывода.
4.  **Надежность:**
    *   Отсутствие утечек ресурсов.
    *   Стабильная работа под нагрузкой и при некорректных данных.

## 7. Примеры запросов и ответов

### Запрос информации о сервере
**Request:**
```http
GET /info HTTP/1.1
Host: localhost:8080
```

**Response:**
```http
HTTP/1.1 200 OK
Content-Type: application/json

{
    "version": "1.0",
    "started": "2023-10-05T12:00:00Z",
    "platform": "Windows",
    "connections": 5
}
```

### Сохранение данных
**Request:**
```http
POST /data HTTP/1.1
Content-Type: application/json
Content-Length: 19

{"name": "test"}
```

**Response:**
```http
HTTP/1.1 201 Created
```

### Получение данных
**Request:**
```http
GET /data/name HTTP/1.1
```

**Response:**
```http
HTTP/1.1 200 OK
Content-Type: application/json

{"name": "test"}
```